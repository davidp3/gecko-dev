/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#ifndef WEBGLMETHODDISPATCHER_H_
#define WEBGLMETHODDISPATCHER_H_

#include "TexUnpackBlob.h"
#include "WebGLCrossProcessCommandQueue.h"
#include "HostWebGLContext.h"
#include "WebGLPcqParamTraits.h"

namespace mozilla {

// The WebGLMethodDispatcher will dispatch commands read from the
// HostWebGLCommandSink and issue them to a given HostWebGLContext.
DECLARE_METHOD_DISPATCHER(WebGLMethodDispatcher, HostWebGLCommandSink,
                          HostWebGLContext)

// Defines each method the WebGLMethodDispatcher handles.  The COUNTER value
// is used as a cross-process ID for each of the methods.
#define DEFINE_METHOD_HELPER(_SYNC, _METHOD)                   \
  DEFINE_METHOD_DISPATCHER(WebGLMethodDispatcher, __COUNTER__, \
                           HostWebGLContext::_METHOD, CommandSyncType::_SYNC)

DEFINE_METHOD_HELPER(SYNC, IsContextLost)
DEFINE_METHOD_HELPER(ASYNC, Disable)
DEFINE_METHOD_HELPER(ASYNC, Enable)
DEFINE_METHOD_HELPER(SYNC, IsEnabled)
DEFINE_METHOD_HELPER(ASYNC, SetContextOptions)
DEFINE_METHOD_HELPER(ASYNC, SetPreferences)
DEFINE_METHOD_HELPER(SYNC, InitializeCanvasRenderer)
DEFINE_METHOD_HELPER(SYNC, SetDimensions)
DEFINE_METHOD_HELPER(SYNC, DrawingBufferSize)
DEFINE_METHOD_HELPER(SYNC, OnMemoryPressure)
DEFINE_METHOD_HELPER(SYNC, GetSupportedExtensions)
DEFINE_METHOD_HELPER(SYNC, Present)
DEFINE_METHOD_HELPER(SYNC, PrepareVRFrame)
DEFINE_METHOD_HELPER(SYNC, GetSurfaceSnapshot)
DEFINE_METHOD_HELPER(ASYNC, AllowContextRestore)
DEFINE_METHOD_HELPER(ASYNC, MakeQueriesAndSyncsAvailable)
DEFINE_METHOD_HELPER(ASYNC, DidRefresh)
DEFINE_METHOD_HELPER(SYNC, GetParameter)
DEFINE_METHOD_HELPER(ASYNC, AttachShader)
DEFINE_METHOD_HELPER(ASYNC, BindAttribLocation)
DEFINE_METHOD_HELPER(ASYNC, BindFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, BindRenderbuffer)
DEFINE_METHOD_HELPER(ASYNC, BlendColor)
DEFINE_METHOD_HELPER(ASYNC, BlendEquation)
DEFINE_METHOD_HELPER(ASYNC, BlendEquationSeparate)
DEFINE_METHOD_HELPER(ASYNC, BlendFunc)
DEFINE_METHOD_HELPER(ASYNC, BlendFuncSeparate)
DEFINE_METHOD_HELPER(SYNC, CheckFramebufferStatus)
DEFINE_METHOD_HELPER(ASYNC, Clear)
DEFINE_METHOD_HELPER(ASYNC, ClearColor)
DEFINE_METHOD_HELPER(ASYNC, ClearDepth)
DEFINE_METHOD_HELPER(ASYNC, ClearStencil)
DEFINE_METHOD_HELPER(ASYNC, ColorMask)
DEFINE_METHOD_HELPER(ASYNC, CompileShader)
DEFINE_METHOD_HELPER(ASYNC, CreateFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, CreateProgram)
DEFINE_METHOD_HELPER(ASYNC, CreateRenderbuffer)
DEFINE_METHOD_HELPER(ASYNC, CreateShader)
DEFINE_METHOD_HELPER(ASYNC, CullFace)
DEFINE_METHOD_HELPER(ASYNC, DeleteFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, DeleteProgram)
DEFINE_METHOD_HELPER(ASYNC, DeleteRenderbuffer)
DEFINE_METHOD_HELPER(ASYNC, DeleteShader)
DEFINE_METHOD_HELPER(ASYNC, DepthFunc)
DEFINE_METHOD_HELPER(ASYNC, DepthMask)
DEFINE_METHOD_HELPER(ASYNC, DepthRange)
DEFINE_METHOD_HELPER(ASYNC, DetachShader)
DEFINE_METHOD_HELPER(ASYNC, Flush)
DEFINE_METHOD_HELPER(SYNC, Finish)
DEFINE_METHOD_HELPER(ASYNC, FramebufferRenderbuffer)
DEFINE_METHOD_HELPER(ASYNC, FramebufferTexture2D)
DEFINE_METHOD_HELPER(ASYNC, FrontFace)
DEFINE_METHOD_HELPER(SYNC, GetActiveAttrib)
DEFINE_METHOD_HELPER(SYNC, GetActiveUniform)
DEFINE_METHOD_HELPER(SYNC, GetAttachedShaders)
DEFINE_METHOD_HELPER(SYNC, GetAttribLocation)
DEFINE_METHOD_HELPER(SYNC, GetBufferParameter)
DEFINE_METHOD_HELPER(SYNC, GetError)
DEFINE_METHOD_HELPER(SYNC, GetFramebufferAttachmentParameter)
DEFINE_METHOD_HELPER(SYNC, GetProgramParameter)
DEFINE_METHOD_HELPER(SYNC, GetProgramInfoLog)
DEFINE_METHOD_HELPER(SYNC, GetRenderbufferParameter)
DEFINE_METHOD_HELPER(SYNC, GetShaderParameter)
DEFINE_METHOD_HELPER(SYNC, GetShaderPrecisionFormat)
DEFINE_METHOD_HELPER(SYNC, GetShaderInfoLog)
DEFINE_METHOD_HELPER(SYNC, GetShaderSource)
DEFINE_METHOD_HELPER(SYNC, GetUniform)
DEFINE_METHOD_HELPER(SYNC, GetUniformLocation)
DEFINE_METHOD_HELPER(ASYNC, Hint)
DEFINE_METHOD_HELPER(ASYNC, LineWidth)
DEFINE_METHOD_HELPER(ASYNC, LinkProgram)
DEFINE_METHOD_HELPER(SYNC, PixelStorei)
DEFINE_METHOD_HELPER(ASYNC, PolygonOffset)
DEFINE_METHOD_HELPER(ASYNC, SampleCoverage)
DEFINE_METHOD_HELPER(ASYNC, Scissor)
DEFINE_METHOD_HELPER(ASYNC, ShaderSource)
DEFINE_METHOD_HELPER(ASYNC, StencilFunc)
DEFINE_METHOD_HELPER(ASYNC, StencilFuncSeparate)
DEFINE_METHOD_HELPER(ASYNC, StencilMask)
DEFINE_METHOD_HELPER(ASYNC, StencilMaskSeparate)
DEFINE_METHOD_HELPER(ASYNC, StencilOp)
DEFINE_METHOD_HELPER(ASYNC, StencilOpSeparate)
DEFINE_METHOD_HELPER(ASYNC, Viewport)
DEFINE_METHOD_HELPER(ASYNC, BindBuffer)
DEFINE_METHOD_HELPER(ASYNC, BindBufferBase)
DEFINE_METHOD_HELPER(ASYNC, BindBufferRange)
DEFINE_METHOD_HELPER(SYNC, CreateBuffer)
DEFINE_METHOD_HELPER(ASYNC, DeleteBuffer)
DEFINE_METHOD_HELPER(ASYNC, CopyBufferSubData)
DEFINE_METHOD_HELPER(SYNC, GetBufferSubData)
DEFINE_METHOD_HELPER(ASYNC, BufferData)
DEFINE_METHOD_HELPER(ASYNC, BufferSubData)
DEFINE_METHOD_HELPER(ASYNC, BlitFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, FramebufferTextureLayer)
DEFINE_METHOD_HELPER(ASYNC, InvalidateFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, InvalidateSubFramebuffer)
DEFINE_METHOD_HELPER(ASYNC, ReadBuffer)
DEFINE_METHOD_HELPER(SYNC, GetInternalformatParameter)
DEFINE_METHOD_HELPER(ASYNC, RenderbufferStorage_base)
DEFINE_METHOD_HELPER(ASYNC, ActiveTexture)
DEFINE_METHOD_HELPER(ASYNC, BindTexture)
DEFINE_METHOD_HELPER(SYNC, CreateTexture)
DEFINE_METHOD_HELPER(ASYNC, DeleteTexture)
DEFINE_METHOD_HELPER(ASYNC, GenerateMipmap)
DEFINE_METHOD_HELPER(ASYNC, CopyTexImage2D)
DEFINE_METHOD_HELPER(ASYNC, TexStorage)
DEFINE_METHOD_HELPER(ASYNC, TexImage)
DEFINE_METHOD_HELPER(ASYNC, TexSubImage)
DEFINE_METHOD_HELPER(ASYNC, CompressedTexImage)
DEFINE_METHOD_HELPER(ASYNC, CompressedTexSubImage)
DEFINE_METHOD_HELPER(ASYNC, CopyTexSubImage)
DEFINE_METHOD_HELPER(SYNC, GetTexParameter)
DEFINE_METHOD_HELPER(ASYNC, TexParameter_base)
DEFINE_METHOD_HELPER(ASYNC, UseProgram)
DEFINE_METHOD_HELPER(ASYNC, ValidateProgram)
DEFINE_METHOD_HELPER(SYNC, GetFragDataLocation)
DEFINE_METHOD_HELPER(ASYNC, UniformNfv)
DEFINE_METHOD_HELPER(ASYNC, UniformNiv)
DEFINE_METHOD_HELPER(ASYNC, UniformNuiv)
DEFINE_METHOD_HELPER(ASYNC, UniformMatrixAxBfv)
DEFINE_METHOD_HELPER(ASYNC, UniformFVec)
DEFINE_METHOD_HELPER(ASYNC, UniformIVec)
DEFINE_METHOD_HELPER(ASYNC, UniformUIVec)
DEFINE_METHOD_HELPER(ASYNC, VertexAttrib4f)
DEFINE_METHOD_HELPER(ASYNC, VertexAttribI4i)
DEFINE_METHOD_HELPER(ASYNC, VertexAttribI4ui)
DEFINE_METHOD_HELPER(ASYNC, VertexAttribDivisor)
DEFINE_METHOD_HELPER(SYNC, GetIndexedParameter)
DEFINE_METHOD_HELPER(SYNC, GetUniformIndices)
DEFINE_METHOD_HELPER(SYNC, GetActiveUniforms)
DEFINE_METHOD_HELPER(SYNC, GetUniformBlockIndex)
DEFINE_METHOD_HELPER(SYNC, GetActiveUniformBlockParameter)
DEFINE_METHOD_HELPER(SYNC, GetActiveUniformBlockName)
DEFINE_METHOD_HELPER(ASYNC, UniformBlockBinding)
DEFINE_METHOD_HELPER(ASYNC, EnableVertexAttribArray)
DEFINE_METHOD_HELPER(ASYNC, DisableVertexAttribArray)
DEFINE_METHOD_HELPER(SYNC, GetVertexAttrib)
DEFINE_METHOD_HELPER(SYNC, GetVertexAttribOffset)
DEFINE_METHOD_HELPER(ASYNC, VertexAttribAnyPointer)
DEFINE_METHOD_HELPER(ASYNC, ClearBufferfv)
DEFINE_METHOD_HELPER(ASYNC, ClearBufferiv)
DEFINE_METHOD_HELPER(ASYNC, ClearBufferuiv)
DEFINE_METHOD_HELPER(ASYNC, ClearBufferfi)
DEFINE_METHOD_HELPER(ASYNC, ReadPixels1)
DEFINE_METHOD_HELPER(SYNC, ReadPixels2)
DEFINE_METHOD_HELPER(ASYNC, CreateSampler)
DEFINE_METHOD_HELPER(ASYNC, DeleteSampler)
DEFINE_METHOD_HELPER(ASYNC, BindSampler)
DEFINE_METHOD_HELPER(ASYNC, SamplerParameteri)
DEFINE_METHOD_HELPER(ASYNC, SamplerParameterf)
DEFINE_METHOD_HELPER(SYNC, GetSamplerParameter)
DEFINE_METHOD_HELPER(SYNC, FenceSync)
DEFINE_METHOD_HELPER(ASYNC, DeleteSync)
DEFINE_METHOD_HELPER(SYNC, ClientWaitSync)
DEFINE_METHOD_HELPER(ASYNC, WaitSync)
DEFINE_METHOD_HELPER(SYNC, GetSyncParameter)
DEFINE_METHOD_HELPER(ASYNC, CreateTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, DeleteTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, BindTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, BeginTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, EndTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, PauseTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, ResumeTransformFeedback)
DEFINE_METHOD_HELPER(ASYNC, TransformFeedbackVaryings)
DEFINE_METHOD_HELPER(SYNC, GetTransformFeedbackVarying)
DEFINE_METHOD_HELPER(ASYNC, EnableExtension)
DEFINE_METHOD_HELPER(ASYNC, EnqueueError)
DEFINE_METHOD_HELPER(ASYNC, EnqueueWarning)
DEFINE_METHOD_HELPER(ASYNC, DrawBuffers)
DEFINE_METHOD_HELPER(SYNC, GetASTCExtensionSupportedProfiles)
DEFINE_METHOD_HELPER(SYNC, GetTranslatedShaderSource)
DEFINE_METHOD_HELPER(ASYNC, LoseContext)
DEFINE_METHOD_HELPER(SYNC, MOZDebugGetParameter)
DEFINE_METHOD_HELPER(ASYNC, RestoreContext)
DEFINE_METHOD_HELPER(ASYNC, BindVertexArray)
DEFINE_METHOD_HELPER(ASYNC, CreateVertexArray)
DEFINE_METHOD_HELPER(ASYNC, DeleteVertexArray)
DEFINE_METHOD_HELPER(ASYNC, DrawArraysInstanced)
DEFINE_METHOD_HELPER(ASYNC, DrawElementsInstanced)
DEFINE_METHOD_HELPER(ASYNC, CreateQuery)
DEFINE_METHOD_HELPER(ASYNC, DeleteQuery)
DEFINE_METHOD_HELPER(ASYNC, BeginQuery)
DEFINE_METHOD_HELPER(ASYNC, EndQuery)
DEFINE_METHOD_HELPER(ASYNC, QueryCounter)
DEFINE_METHOD_HELPER(SYNC, GetQuery)
DEFINE_METHOD_HELPER(SYNC, GetQueryParameter)

DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLBuffer>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLFramebuffer>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLProgram>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLQuery>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLRenderbuffer>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLSampler>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLShader>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLSync>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLTexture>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLTransformFeedback>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLUniformLocation>)
DEFINE_METHOD_HELPER(ASYNC, ReleaseWebGLObject<WebGLVertexArray>)

// clang-format on

#undef DEFINE_METHOD_HELPER

}  // namespace mozilla

#endif  // WEBGLMETHODDISPATCHER_H_
